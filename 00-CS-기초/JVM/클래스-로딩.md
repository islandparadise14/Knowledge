---
tags: [cs, jvm, class-loading, android]
---

# í´ë˜ìŠ¤ ë¡œë”©

## ğŸ’¡ í•µì‹¬ ê°œë…

**í´ë˜ìŠ¤ ë¡œë”©**ì€ `.class`(JVM) ë˜ëŠ” `.dex`(Android) íŒŒì¼ì—ì„œ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ëŠ” ê³¼ì •ì´ë‹¤. **ë¡œë”© â†’ ë§í‚¹(ê²€ì¦/ì¤€ë¹„/í•´ì„) â†’ ì´ˆê¸°í™”** 3ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤. í´ë˜ìŠ¤ëŠ” ì²˜ìŒ ì‚¬ìš©ë  ë•Œ ë¡œë”©ëœë‹¤(Lazy Loading).

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

`ClassNotFoundException`, `NoClassDefFoundError` ê°™ì€ ì—ëŸ¬ì˜ ì›ì¸ì„ ì´í•´í•  ìˆ˜ ìˆë‹¤. MultiDex, Dynamic Feature Module, ProGuard ë‚œë…í™” ë¬¸ì œë„ í´ë˜ìŠ¤ ë¡œë”©ê³¼ ê´€ë ¨ëœë‹¤.

## ğŸ” ìì„¸íˆ

### í´ë˜ìŠ¤ ë¡œë”© ê³¼ì •

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Loading â”‚ â†’  â”‚        Linking             â”‚ â†’  â”‚  Init    â”‚
â”‚ .class   â”‚    â”‚ Verify â†’ Prepare â†’ Resolve â”‚    â”‚ <clinit> â”‚
â”‚ ì½ê¸°     â”‚    â”‚ ê²€ì¦   â†’ ì¤€ë¹„    â†’ í•´ì„    â”‚    â”‚ static{} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Loading:** ë°”ì´íŠ¸ì½”ë“œë¥¼ ì½ì–´ Class ê°ì²´ ìƒì„±
- **Verify:** ë°”ì´íŠ¸ì½”ë“œê°€ ìœ íš¨í•œì§€ ê²€ì¦
- **Prepare:** static ë³€ìˆ˜ì— ê¸°ë³¸ê°’ í• ë‹¹ (0, null ë“±)
- **Resolve:** ì‹¬ë³¼ë¦­ ì°¸ì¡°ë¥¼ ì‹¤ì œ ì°¸ì¡°ë¡œ ë³€í™˜
- **Init:** static ì´ˆê¸°í™” ë¸”ë¡ê³¼ static ë³€ìˆ˜ ì´ˆê¸°ê°’ í• ë‹¹

### JVMì˜ í´ë˜ìŠ¤ ë¡œë” ê³„ì¸µ

```
Bootstrap ClassLoader      â† java.lang.* ë“± í•µì‹¬ í´ë˜ìŠ¤
        â”‚
Extension ClassLoader      â† javax.*, í™•ì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬
        â”‚
Application ClassLoader    â† classpathì˜ í´ë˜ìŠ¤
        â”‚
Custom ClassLoader         â† ì‚¬ìš©ì ì •ì˜
```

**ìœ„ì„ ëª¨ë¸ (Parent Delegation):** ìì‹ì´ ë¨¼ì € ë¶€ëª¨ì—ê²Œ ë¡œë”©ì„ ìœ„ì„í•œë‹¤. ë¶€ëª¨ê°€ ëª» ì°¾ìœ¼ë©´ ìì‹ì´ ì§ì ‘ ë¡œë”©.

### Androidì˜ í´ë˜ìŠ¤ ë¡œë”©

AndroidëŠ” JVMì˜ ClassLoader ëŒ€ì‹  ìì²´ ë¡œë”ë¥¼ ì‚¬ìš©í•œë‹¤.

```
BootClassLoader           â† Android í”„ë ˆì„ì›Œí¬ í´ë˜ìŠ¤
        â”‚
PathClassLoader           â† APKì˜ DEXì—ì„œ í´ë˜ìŠ¤ ë¡œë”© (ê¸°ë³¸)
        â”‚
DexClassLoader            â† ì™¸ë¶€ DEX/JAR ë¡œë”© ê°€ëŠ¥
```

```kotlin
// í˜„ì¬ í´ë˜ìŠ¤ ë¡œë” í™•ì¸
val classLoader = this::class.java.classLoader
Log.d("CL", "Loader: ${classLoader?.javaClass?.name}")
// â†’ dalvik.system.PathClassLoader
```

### MultiDexì™€ í´ë˜ìŠ¤ ë¡œë”©

DEX íŒŒì¼ í•˜ë‚˜ì—ëŠ” ë©”ì„œë“œê°€ 65,536ê°œ(64K)ê¹Œì§€ë§Œ ë“¤ì–´ê°„ë‹¤. ì´ˆê³¼ ì‹œ ì—¬ëŸ¬ DEXë¡œ ë¶„ë¦¬ëœë‹¤.

```groovy
// build.gradle.kts
android {
    defaultConfig {
        multiDexEnabled = true  // minSdk < 21ì¼ ë•Œ í•„ìš”
    }
}

// minSdk 21+ (ART)ëŠ” ë„¤ì´í‹°ë¸Œë¡œ MultiDex ì§€ì› â†’ ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”
```

### í´ë˜ìŠ¤ ì´ˆê¸°í™” ì‹œì 

```kotlin
object DatabaseHelper {
    // objectëŠ” ì²˜ìŒ ì ‘ê·¼í•  ë•Œ ì´ˆê¸°í™”ë¨ (lazy)
    init {
        Log.d("DB", "DatabaseHelper ì´ˆê¸°í™”")
    }
}

class MyApp : Application() {
    override fun onCreate() {
        super.onCreate()
        // ì´ ì‹œì ì— ì•„ì§ DatabaseHelperëŠ” ë¡œë”©ë˜ì§€ ì•ŠìŒ
        DatabaseHelper  // â† ì´ë•Œ ë¹„ë¡œì†Œ ë¡œë”© + ì´ˆê¸°í™”
    }
}
```

### í”í•œ ì—ëŸ¬

```kotlin
// ClassNotFoundException - í´ë˜ìŠ¤ íŒŒì¼ ìì²´ë¥¼ ëª» ì°¾ìŒ
// â†’ ProGuardê°€ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì œê±°í–ˆì„ ë•Œ ë°œìƒ
// proguard-rules.pro
-keep class com.example.model.** { *; }

// NoClassDefFoundError - ì»´íŒŒì¼ ì‹œì—” ìˆì—ˆì§€ë§Œ ëŸ°íƒ€ì„ì— ì—†ìŒ
// â†’ ì˜ì¡´ì„± ë²„ì „ ë¶ˆì¼ì¹˜, MultiDex ë¯¸ì„¤ì • ì‹œ ë°œìƒ
```

## ğŸ”— ê´€ë ¨ ê°œë…

- [[00-CS-ê¸°ì´ˆ/JVM/JVM-êµ¬ì¡°|JVM êµ¬ì¡°]]
- [[00-CS-ê¸°ì´ˆ/JVM/DEX-íŒŒì¼|DEX íŒŒì¼]]
- [[00-CS-ê¸°ì´ˆ/ì»´íŒŒì¼ê³¼-ëŸ°íƒ€ì„/ì»´íŒŒì¼-ê³¼ì •|ì»´íŒŒì¼ ê³¼ì •]]

## ğŸ“š ë” ë³´ê¸°

- [Android ClassLoader](https://developer.android.com/reference/java/lang/ClassLoader)
- [MultiDex ê°€ì´ë“œ](https://developer.android.com/build/multidex)

---

**í•µì‹¬ ìš”ì•½:** í´ë˜ìŠ¤ëŠ” ì²˜ìŒ ì‚¬ìš© ì‹œ ë¡œë”© â†’ ë§í‚¹ â†’ ì´ˆê¸°í™” ìˆœìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°„ë‹¤. AndroidëŠ” PathClassLoaderë¡œ DEXì—ì„œ ë¡œë”©í•˜ë©°, 64K ë©”ì„œë“œ ì œí•œ ì‹œ MultiDexê°€ í•„ìš”í•˜ë‹¤.
