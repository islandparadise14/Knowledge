---
tags: [network, cookie, session, token, jwt, authentication, cs-ê¸°ì´ˆ]
---

# ì¿ í‚¤ / ì„¸ì…˜ / í† í°

## ğŸ’¡ í•µì‹¬ ê°œë…

**ì¿ í‚¤(Cookie)**ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ëŠ” í‚¤-ê°’ ë°ì´í„°ì´ê³ , **ì„¸ì…˜(Session)**ì€ ì„œë²„ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì‚¬ìš©ì ìƒíƒœ ì •ë³´ì´ë©°, **í† í°(Token)**ì€ ì„œë²„ê°€ ë°œí–‰í•œ ì¸ì¦ ì¦ëª…ì„œë‹¤. HTTPëŠ” Statelessí•˜ë¯€ë¡œ ì´ ì„¸ ê°€ì§€ë¥¼ í†µí•´ ì‚¬ìš©ìë¥¼ ì‹ë³„í•œë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

ëª¨ë°”ì¼ ì•±ì€ ì£¼ë¡œ í† í° ê¸°ë°˜ ì¸ì¦(JWT)ì„ ì‚¬ìš©í•œë‹¤. ì¿ í‚¤/ì„¸ì…˜ì€ ì›¹ ì¤‘ì‹¬ì´ì§€ë§Œ WebViewë‚˜ í•˜ì´ë¸Œë¦¬ë“œ ì•±ì—ì„œ ë‹¤ë£¨ê²Œ ëœë‹¤. Access Tokenê³¼ Refresh Tokenì˜ ê´€ë¦¬ëŠ” ì•± ë³´ì•ˆì˜ í•µì‹¬ì´ë‹¤.

## ğŸ” ìì„¸íˆ

### ì„¸ ê°€ì§€ ë°©ì‹ ë¹„êµ

| íŠ¹ì„± | ì¿ í‚¤ | ì„¸ì…˜ | í† í° (JWT) |
|------|------|------|-----------|
| ì €ì¥ ìœ„ì¹˜ | í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¼ìš°ì €) | ì„œë²„ | í´ë¼ì´ì–¸íŠ¸ (ì•±) |
| ìƒíƒœ ê´€ë¦¬ | Stateful | Stateful | Stateless |
| í™•ì¥ì„± | ë³´í†µ | ë‚®ìŒ (ì„œë²„ ë©”ëª¨ë¦¬) | ë†’ìŒ |
| ëª¨ë°”ì¼ ì í•©ì„± | ë‚®ìŒ | ë‚®ìŒ | ë†’ìŒ |
| ë§Œë£Œ | ì„œë²„ ì„¤ì • | ì„œë²„ ì„¤ì • | í† í° ìì²´ì— í¬í•¨ |

### JWT (JSON Web Token) êµ¬ì¡°

```
eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMjMiLCJleHAiOjE3MDk5fQ.signature
 â”€â”€â”€â”€â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€ Payload â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€ Signature â”€â”€

Header:  {"alg": "HS256", "typ": "JWT"}
Payload: {"sub": "123", "name": "í™ê¸¸ë™", "exp": 1709900000}
Signature: HMACSHA256(base64(header) + "." + base64(payload), secret)
```

### Androidì—ì„œ í† í° ê¸°ë°˜ ì¸ì¦ êµ¬í˜„

```kotlin
// í† í° ì €ì¥ - EncryptedSharedPreferences ì‚¬ìš©
class TokenManager(context: Context) {
    private val prefs = EncryptedSharedPreferences.create(
        "auth_prefs",
        MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC),
        context,
        EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
        EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
    )

    var accessToken: String?
        get() = prefs.getString("access_token", null)
        set(value) = prefs.edit().putString("access_token", value).apply()

    var refreshToken: String?
        get() = prefs.getString("refresh_token", null)
        set(value) = prefs.edit().putString("refresh_token", value).apply()

    fun clearTokens() {
        prefs.edit().clear().apply()
    }
}
```

### OkHttp ì¸í„°ì…‰í„°ë¡œ í† í° ìë™ ì²¨ë¶€

```kotlin
// ìš”ì²­ì— Access Token ìë™ ì¶”ê°€
class AuthInterceptor(
    private val tokenManager: TokenManager
) : Interceptor {

    override fun intercept(chain: Interceptor.Chain): okhttp3.Response {
        val request = chain.request()

        // í† í°ì´ í•„ìš” ì—†ëŠ” ì—”ë“œí¬ì¸íŠ¸ ì œì™¸
        if (request.url.encodedPath.contains("auth/login")) {
            return chain.proceed(request)
        }

        val token = tokenManager.accessToken
        val authenticatedRequest = request.newBuilder()
            .addHeader("Authorization", "Bearer $token")
            .build()

        return chain.proceed(authenticatedRequest)
    }
}
```

### Token Refresh ìë™ ì²˜ë¦¬ (Authenticator)

```kotlin
// 401 ì‘ë‹µ ì‹œ ìë™ìœ¼ë¡œ í† í° ê°±ì‹ 
class TokenAuthenticator(
    private val tokenManager: TokenManager,
    private val authApi: AuthApi
) : Authenticator {

    override fun authenticate(
        route: Route?,
        response: okhttp3.Response
    ): Request? {
        // ì´ë¯¸ ì¬ì‹œë„í•œ ê²½ìš° ë¬´í•œ ë£¨í”„ ë°©ì§€
        if (response.request.header("X-Retry") != null) {
            tokenManager.clearTokens()
            return null  // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        }

        synchronized(this) {
            // ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì´ë¯¸ ê°±ì‹ í–ˆëŠ”ì§€ í™•ì¸
            val currentToken = tokenManager.accessToken
            val requestToken = response.request.header("Authorization")
                ?.removePrefix("Bearer ")

            if (currentToken != requestToken && currentToken != null) {
                // ì´ë¯¸ ê°±ì‹ ëœ í† í° ì‚¬ìš©
                return response.request.newBuilder()
                    .header("Authorization", "Bearer $currentToken")
                    .build()
            }

            // í† í° ê°±ì‹ 
            val refreshToken = tokenManager.refreshToken ?: return null
            val newTokens = authApi.refreshToken(refreshToken)

            return if (newTokens != null) {
                tokenManager.accessToken = newTokens.accessToken
                tokenManager.refreshToken = newTokens.refreshToken

                response.request.newBuilder()
                    .header("Authorization", "Bearer ${newTokens.accessToken}")
                    .header("X-Retry", "true")
                    .build()
            } else {
                tokenManager.clearTokens()
                null  // ë¡œê·¸ì•„ì›ƒ
            }
        }
    }
}

// OkHttpì— ì ìš©
val client = OkHttpClient.Builder()
    .addInterceptor(AuthInterceptor(tokenManager))
    .authenticator(TokenAuthenticator(tokenManager, authApi))
    .build()
```

### Access Token vs Refresh Token

```
Access Token:
â”œâ”€â”€ ì§§ì€ ë§Œë£Œ ì‹œê°„ (15ë¶„ ~ 1ì‹œê°„)
â”œâ”€â”€ API ìš”ì²­ë§ˆë‹¤ í—¤ë”ì— í¬í•¨
â”œâ”€â”€ íƒˆì·¨ë˜ì–´ë„ í”¼í•´ ì‹œê°„ ì œí•œ
â””â”€â”€ ë§Œë£Œ ì‹œ Refresh Tokenìœ¼ë¡œ ê°±ì‹ 

Refresh Token:
â”œâ”€â”€ ê¸´ ë§Œë£Œ ì‹œê°„ (7ì¼ ~ 30ì¼)
â”œâ”€â”€ Access Token ê°±ì‹  ìš©ë„ë¡œë§Œ ì‚¬ìš©
â”œâ”€â”€ ì•ˆì „í•˜ê²Œ ì €ì¥ (EncryptedSharedPreferences)
â””â”€â”€ ë§Œë£Œ ì‹œ ì¬ë¡œê·¸ì¸ í•„ìš”
```

### WebViewì—ì„œ ì¿ í‚¤ ê´€ë¦¬

```kotlin
// WebViewì—ì„œ ì„œë²„ ì¿ í‚¤ë¥¼ ì„¤ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°
val cookieManager = CookieManager.getInstance()
cookieManager.setAcceptCookie(true)

// í† í°ì„ ì¿ í‚¤ë¡œ ë³€í™˜í•´ WebViewì— ì „ë‹¬
val token = tokenManager.accessToken
cookieManager.setCookie(
    "https://web.example.com",
    "auth_token=$token; Path=/; Secure; HttpOnly"
)

// WebView ë¡œë“œ
webView.loadUrl("https://web.example.com/dashboard")
```

## ğŸ”— ê´€ë ¨ ê°œë…

- [[00-CS-ê¸°ì´ˆ/ë„¤íŠ¸ì›Œí¬/HTTP-HTTPS|HTTP/HTTPS]]
- [[00-CS-ê¸°ì´ˆ/ë„¤íŠ¸ì›Œí¬/REST-API|REST API]]
- [[00-CS-ê¸°ì´ˆ/ë³´ì•ˆ-ê¸°ì´ˆ/OAuth-JWT|OAuth / JWT]]
- [[00-CS-ê¸°ì´ˆ/ë³´ì•ˆ-ê¸°ì´ˆ/ì¸ì¦-vs-ì¸ê°€|ì¸ì¦ vs ì¸ê°€]]

## ğŸ“š ë” ë³´ê¸°

- [Android EncryptedSharedPreferences](https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences)
- [OkHttp Authenticator](https://square.github.io/okhttp/recipes/#handling-authentication-kt-java)

---

**í•µì‹¬ ìš”ì•½:** ëª¨ë°”ì¼ ì•±ì€ í† í°(JWT) ê¸°ë°˜ ì¸ì¦ì´ í‘œì¤€. EncryptedSharedPreferencesì— ì €ì¥í•˜ê³ , OkHttp Interceptor/Authenticatorë¡œ ìë™ ê´€ë¦¬.
