---
tags: [CS, ë™ì‹œì„±, ë®¤í…ìŠ¤, ì„¸ë§ˆí¬ì–´, ë™ê¸°í™”, Android]
---

# ë®¤í…ìŠ¤ì™€ ì„¸ë§ˆí¬ì–´

## ğŸ’¡ í•µì‹¬ ê°œë…

**ë®¤í…ìŠ¤(Mutex)**ëŠ” ìƒí˜¸ ë°°ì œ(Mutual Exclusion)ë¥¼ ë³´ì¥í•˜ëŠ” ë™ê¸°í™” ë„êµ¬ë¡œ, í•œ ë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œ(ë˜ëŠ” ì½”ë£¨í‹´)ë§Œ ì„ê³„ ì˜ì—­ì— ì§„ì…í•  ìˆ˜ ìˆê²Œ í•œë‹¤. **ì„¸ë§ˆí¬ì–´(Semaphore)**ëŠ” ë™ì‹œì— ì ‘ê·¼ ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œ ìˆ˜ë¥¼ Nê°œë¡œ ì œí•œí•˜ëŠ” ë™ê¸°í™” ë„êµ¬ì´ë‹¤. ë®¤í…ìŠ¤ëŠ” ì„¸ë§ˆí¬ì–´ì˜ íŠ¹ìˆ˜í•œ ê²½ìš°(N=1)ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

Androidì—ì„œ ê³µìœ  ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ì½”ë£¨í‹´ì´ ë™ì‹œì— ìˆ˜ì •í•˜ë©´ ê²½ìŸ ì¡°ê±´ì´ ë°œìƒí•œë‹¤. ë®¤í…ìŠ¤ì™€ ì„¸ë§ˆí¬ì–´ë¥¼ í™œìš©í•˜ë©´ ê³µìœ  ìì›ì— ëŒ€í•œ ë™ì‹œ ì ‘ê·¼ì„ ì•ˆì „í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆìœ¼ë©°, ì½”ë£¨í‹´ì—ì„œëŠ” `kotlinx.coroutines.sync.Mutex`ì™€ `Semaphore`ë¥¼ ì‚¬ìš©í•œë‹¤.

## ğŸ” ìì„¸íˆ

### ë®¤í…ìŠ¤ì™€ ì„¸ë§ˆí¬ì–´ ë¹„êµ

| êµ¬ë¶„ | ë®¤í…ìŠ¤ (Mutex) | ì„¸ë§ˆí¬ì–´ (Semaphore) |
|------|----------------|----------------------|
| ë™ì‹œ ì ‘ê·¼ ìˆ˜ | 1ê°œë§Œ í—ˆìš© | Nê°œê¹Œì§€ í—ˆìš© |
| ìš©ë„ | ìƒí˜¸ ë°°ì œ, ì„ê³„ ì˜ì—­ ë³´í˜¸ | ë¦¬ì†ŒìŠ¤ í’€ ì œí•œ, ë™ì‹œì„± ì œì–´ |
| ì†Œìœ ê¶Œ | ìˆìŒ (ë½ì„ ê±´ ì£¼ì²´ë§Œ í•´ì œ ê°€ëŠ¥) | ì—†ìŒ (ëˆ„êµ¬ë‚˜ release ê°€ëŠ¥) |
| ì½”ë£¨í‹´ API | `Mutex` | `Semaphore` |
| ì „í†µì  API | `synchronized`, `ReentrantLock` | `java.util.concurrent.Semaphore` |

### ì½”ë£¨í‹´ Mutex ì‚¬ìš©

```kotlin
import kotlinx.coroutines.sync.Mutex
import kotlinx.coroutines.sync.withLock

class UserRepository {
    private val mutex = Mutex()
    private val cache = mutableMapOf<String, User>()

    suspend fun getUser(id: String): User {
        // withLock: í•œ ë²ˆì— í•˜ë‚˜ì˜ ì½”ë£¨í‹´ë§Œ ìºì‹œì— ì ‘ê·¼
        return mutex.withLock {
            cache.getOrPut(id) {
                api.fetchUser(id) // ìºì‹œì— ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ
            }
        }
    }

    suspend fun updateUser(user: User) {
        mutex.withLock {
            cache[user.id] = user
            api.updateUser(user)
        }
    }
}
```

### synchronized vs Mutex

```kotlin
// âŒ synchronizedëŠ” ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹ - ì½”ë£¨í‹´ì—ì„œ ë¹„íš¨ìœ¨ì 
class BlockingCounter {
    private var count = 0

    @Synchronized
    fun increment() {
        count++ // ìŠ¤ë ˆë“œê°€ ë¸”ë¡œí‚¹ë¨ (ë‹¤ë¥¸ ì½”ë£¨í‹´ì´ ê°™ì€ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš© ëª»í•¨)
    }
}

// âœ… MutexëŠ” ì½”ë£¨í‹´ì„ ì¼ì‹œ ì¤‘ë‹¨ - ìŠ¤ë ˆë“œëŠ” ë‹¤ë¥¸ ì½”ë£¨í‹´ ì‹¤í–‰ ê°€ëŠ¥
class SuspendingCounter {
    private val mutex = Mutex()
    private var count = 0

    suspend fun increment() {
        mutex.withLock {
            count++ // ì½”ë£¨í‹´ë§Œ ì¼ì‹œ ì¤‘ë‹¨, ìŠ¤ë ˆë“œëŠ” ììœ 
        }
    }
}
```

### ì„¸ë§ˆí¬ì–´ë¥¼ í™œìš©í•œ ë™ì‹œì„± ì œí•œ

```kotlin
import kotlinx.coroutines.sync.Semaphore
import kotlinx.coroutines.sync.withPermit

// ë™ì‹œì— ìµœëŒ€ 3ê°œì˜ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ë§Œ í—ˆìš©
val networkSemaphore = Semaphore(3)

suspend fun downloadImages(urls: List<String>): List<Bitmap> = coroutineScope {
    urls.map { url ->
        async(Dispatchers.IO) {
            networkSemaphore.withPermit {
                // ìµœëŒ€ 3ê°œì˜ ì½”ë£¨í‹´ë§Œ ë™ì‹œì— ì‹¤í–‰
                imageLoader.download(url)
            }
        }
    }.awaitAll()
}
```

### ì‹¤ì „ ì˜ˆì‹œ: Rate Limiting

```kotlin
class RateLimitedApiClient(
    private val maxConcurrent: Int = 5,
    private val api: ApiService
) {
    private val semaphore = Semaphore(maxConcurrent)

    suspend fun <T> execute(call: suspend ApiService.() -> T): T {
        return semaphore.withPermit {
            api.call()
        }
    }
}

// ì‚¬ìš©
val client = RateLimitedApiClient(maxConcurrent = 3, api = retrofit.create())

coroutineScope {
    val results = ids.map { id ->
        async {
            client.execute { getItem(id) } // ìµœëŒ€ 3ê°œë§Œ ë™ì‹œ í˜¸ì¶œ
        }
    }.awaitAll()
}
```

### ì‹¤ì „ ì˜ˆì‹œ: ë°ì´í„°ë² ì´ìŠ¤ ì“°ê¸° ë³´í˜¸

```kotlin
class TransactionManager {
    private val writeMutex = Mutex()
    private val readSemaphore = Semaphore(10) // ë™ì‹œ ì½ê¸° ìµœëŒ€ 10ê°œ

    suspend fun <T> read(block: suspend () -> T): T {
        return readSemaphore.withPermit {
            block()
        }
    }

    suspend fun <T> write(block: suspend () -> T): T {
        return writeMutex.withLock {
            // ì“°ê¸°ëŠ” í•œ ë²ˆì— í•˜ë‚˜ë§Œ
            block()
        }
    }
}
```

### ì£¼ì˜ì‚¬í•­: MutexëŠ” ì¬ì§„ì… ë¶ˆê°€

```kotlin
val mutex = Mutex()

suspend fun outer() {
    mutex.withLock {
        inner() // âŒ ë°ë“œë½ ë°œìƒ!
    }
}

suspend fun inner() {
    mutex.withLock { // ì´ë¯¸ ë½ì´ ê±¸ë ¤ìˆì–´ ì˜ì›íˆ ëŒ€ê¸°
        doWork()
    }
}

// í•´ê²°: ë‚´ë¶€ í•¨ìˆ˜ì—ì„œ ë½ì„ ìš”êµ¬í•˜ì§€ ì•Šë„ë¡ êµ¬ì¡° ë³€ê²½
suspend fun outerFixed() {
    mutex.withLock {
        innerWithoutLock()
    }
}

suspend fun innerWithoutLock() {
    doWork() // ë½ ì—†ì´ ì‹¤í–‰
}
```

## ğŸ”— ê´€ë ¨ ê°œë…

- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/ê²½ìŸ-ì¡°ê±´|ê²½ìŸ ì¡°ê±´]]
- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/êµì°©ìƒíƒœ-ë°ë“œë½|êµì°©ìƒíƒœ (ë°ë“œë½)]]
- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/í”„ë¡œì„¸ìŠ¤-vs-ìŠ¤ë ˆë“œ|í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œ]]
- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/ë™ì‹œì„±-vs-ë³‘ë ¬ì„±|ë™ì‹œì„± vs ë³‘ë ¬ì„±]]

## ğŸ“š ë” ë³´ê¸°

- [Kotlin Mutex ê³µì‹ ë¬¸ì„œ](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.sync/-mutex/)
- [Kotlin Semaphore ê³µì‹ ë¬¸ì„œ](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.sync/-semaphore/)

---

**í•µì‹¬ ìš”ì•½:** ë®¤í…ìŠ¤ëŠ” í•˜ë‚˜ì˜ ì½”ë£¨í‹´ë§Œ ì„ê³„ ì˜ì—­ì— ì ‘ê·¼í•˜ê²Œ í•˜ëŠ” ìƒí˜¸ ë°°ì œ ë„êµ¬ì´ê³ , ì„¸ë§ˆí¬ì–´ëŠ” ë™ì‹œ ì ‘ê·¼ ìˆ˜ë¥¼ Nê°œë¡œ ì œí•œí•˜ëŠ” ë„êµ¬ë¡œ, ì½”ë£¨í‹´ì—ì„œëŠ” ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹í•˜ì§€ ì•ŠëŠ” `kotlinx.coroutines.sync`ì˜ Mutex/Semaphoreë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.