---
tags: [CS, ë™ì‹œì„±, ìŠ¤ë ˆë“œí’€, Dispatchers, Android]
---

# ìŠ¤ë ˆë“œ í’€

## ğŸ’¡ í•µì‹¬ ê°œë…

**ìŠ¤ë ˆë“œ í’€(Thread Pool)**ì€ ë¯¸ë¦¬ ìƒì„±ëœ ìŠ¤ë ˆë“œë“¤ì˜ ì§‘í•©ìœ¼ë¡œ, ì‘ì—…ì´ ë“¤ì–´ì˜¤ë©´ ìœ íœ´ ìŠ¤ë ˆë“œì— í• ë‹¹í•˜ê³  ì™„ë£Œ í›„ ìŠ¤ë ˆë“œë¥¼ ì¬ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤. ìŠ¤ë ˆë“œ ìƒì„±/ì†Œë©¸ì˜ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì´ê³  ë™ì‹œ ì‹¤í–‰ ìŠ¤ë ˆë“œ ìˆ˜ë¥¼ ì œí•œí•œë‹¤. Android ì½”ë£¨í‹´ì˜ `Dispatchers.IO`, `Dispatchers.Default`ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìŠ¤ë ˆë“œ í’€ì„ ì‚¬ìš©í•œë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

ìŠ¤ë ˆë“œë¥¼ ì‘ì—…ë§ˆë‹¤ ìƒˆë¡œ ìƒì„±í•˜ë©´ ë©”ëª¨ë¦¬ì™€ CPUë¥¼ ê³¼ë„í•˜ê²Œ ì†Œë¹„í•œë‹¤. Androidì—ì„œëŠ” ì½”ë£¨í‹´ì˜ Dispatcherê°€ ìŠ¤ë ˆë“œ í’€ì„ ê´€ë¦¬í•˜ë¯€ë¡œ ì§ì ‘ ë§Œë“¤ ì¼ì€ ë“œë¬¼ì§€ë§Œ, Dispatcherì˜ íŠ¹ì„±ì„ ì´í•´í•´ì•¼ ì˜¬ë°”ë¥¸ Dispatcherë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤.

## ğŸ” ìì„¸íˆ

### ìŠ¤ë ˆë“œ í’€ì˜ ë™ì‘ ì›ë¦¬

```
ì‘ì—… í:  [ì‘ì—…1] [ì‘ì—…2] [ì‘ì—…3] [ì‘ì—…4] [ì‘ì—…5] ...
             |       |       |
          ìŠ¤ë ˆë“œ1  ìŠ¤ë ˆë“œ2  ìŠ¤ë ˆë“œ3   (í’€ í¬ê¸°: 3)
             |       |       |
          [ì‘ì—…1]  [ì‘ì—…2]  [ì‘ì—…3]  <- ë™ì‹œ ì‹¤í–‰
          ì™„ë£Œ ->  [ì‘ì—…4]           <- ìŠ¤ë ˆë“œ1ì´ ì‘ì—…4ë¥¼ ë°›ìŒ
                   ì™„ë£Œ ->  [ì‘ì—…5]  <- ìŠ¤ë ˆë“œ2ê°€ ì‘ì—…5ë¥¼ ë°›ìŒ
```

### Android ì½”ë£¨í‹´ Dispatchers

```kotlin
// Dispatchers.Main: ë©”ì¸ ìŠ¤ë ˆë“œ (ë‹¨ì¼ ìŠ¤ë ˆë“œ)
// - UI ì—…ë°ì´íŠ¸, ê°€ë²¼ìš´ ì‘ì—…
// - ë‚´ë¶€ì ìœ¼ë¡œ Handler(Looper.getMainLooper())ë¥¼ ì‚¬ìš©
lifecycleScope.launch(Dispatchers.Main) {
    textView.text = "ì—…ë°ì´íŠ¸"
}

// Dispatchers.Default: CPU ë°”ìš´ë“œ ì‘ì—…ìš© ìŠ¤ë ˆë“œ í’€
// - ìŠ¤ë ˆë“œ ìˆ˜: CPU ì½”ì–´ ìˆ˜ (ìµœì†Œ 2ê°œ)
// - JSON íŒŒì‹±, ì •ë ¬, ë³µì¡í•œ ê³„ì‚°
lifecycleScope.launch {
    val sorted = withContext(Dispatchers.Default) {
        largeList.sortedBy { it.name } // CPU ì§‘ì•½ì  ì‘ì—…
    }
}

// Dispatchers.IO: I/O ë°”ìš´ë“œ ì‘ì—…ìš© ìŠ¤ë ˆë“œ í’€
// - ìŠ¤ë ˆë“œ ìˆ˜: ìµœëŒ€ 64ê°œ (ë˜ëŠ” ì½”ì–´ ìˆ˜ ì¤‘ í° ê°’)
// - ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ, DB ì¿¼ë¦¬, íŒŒì¼ ì½ê¸°/ì“°ê¸°
lifecycleScope.launch {
    val data = withContext(Dispatchers.IO) {
        database.query("SELECT * FROM users") // ë¸”ë¡œí‚¹ I/O
    }
}

// Dispatchers.Unconfined: íŠ¹ì • ìŠ¤ë ˆë“œì— í•œì •ë˜ì§€ ì•ŠìŒ
// - ì²« ë²ˆì§¸ suspension pointê¹Œì§€ëŠ” í˜¸ì¶œí•œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
// - ì´í›„ì—ëŠ” resumeí•œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
// - í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œë§Œ ê¶Œì¥
```

### Dispatchers.IO vs Dispatchers.Default ì°¨ì´

```kotlin
// Default: CPU ì½”ì–´ ìˆ˜ë§Œí¼ë§Œ ìŠ¤ë ˆë“œ (ì˜ˆ: 8ì½”ì–´ -> 8ìŠ¤ë ˆë“œ)
// -> CPUë¥¼ ë§ì´ ì“°ëŠ” ì‘ì—…ì— ìµœì í™”, ê³¼ë„í•œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë°©ì§€

// IO: ìµœëŒ€ 64ê°œ ìŠ¤ë ˆë“œ
// -> ìŠ¤ë ˆë“œê°€ I/O ëŒ€ê¸°ë¡œ ë¸”ë¡œí‚¹ë˜ë¯€ë¡œ ë” ë§ì€ ìŠ¤ë ˆë“œê°€ í•„ìš”

// í•µì‹¬: Defaultì™€ IOëŠ” ê°™ì€ ìŠ¤ë ˆë“œ í’€ì„ ê³µìœ í•œë‹¤!
// IO ì‘ì—…ì´ Default ìŠ¤ë ˆë“œë¥¼ ëª¨ë‘ ë¸”ë¡œí‚¹í•˜ì§€ ì•Šë„ë¡ ë‚´ë¶€ì ìœ¼ë¡œ ë¶„ë¦¬

lifecycleScope.launch {
    // âŒ ì˜ëª»ëœ ì‚¬ìš©: IO ì‘ì—…ì„ Defaultì—ì„œ ì‹¤í–‰
    withContext(Dispatchers.Default) {
        api.fetchData() // ë¸”ë¡œí‚¹ I/O -> Default ìŠ¤ë ˆë“œë¥¼ ë‚­ë¹„
    }

    // âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©
    withContext(Dispatchers.IO) {
        api.fetchData() // I/O ì „ìš© ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
    }
}
```

### limitedParallelismìœ¼ë¡œ ì»¤ìŠ¤í…€ í’€ ìƒì„±

```kotlin
// íŠ¹ì • ì‘ì—…ì˜ ë™ì‹œ ì‹¤í–‰ ìˆ˜ë¥¼ ì œí•œí•˜ëŠ” ì»¤ìŠ¤í…€ Dispatcher
val imageProcessingDispatcher = Dispatchers.Default.limitedParallelism(2)
val dbDispatcher = Dispatchers.IO.limitedParallelism(4)

// ì´ë¯¸ì§€ ì²˜ë¦¬: ìµœëŒ€ 2ê°œ ë™ì‹œ ì‹¤í–‰ (ë©”ëª¨ë¦¬ ì ˆì•½)
suspend fun processImage(bitmap: Bitmap): Bitmap {
    return withContext(imageProcessingDispatcher) {
        applyFilters(bitmap)
    }
}

// DB ì‘ì—…: ìµœëŒ€ 4ê°œ ë™ì‹œ ì‹¤í–‰
suspend fun batchInsert(items: List<Item>) {
    return withContext(dbDispatcher) {
        database.insertAll(items)
    }
}
```

### ì „í†µì ì¸ ìŠ¤ë ˆë“œ í’€ (ExecutorService)

```kotlin
// Javaì˜ ExecutorServiceë¥¼ ì½”ë£¨í‹´ Dispatcherë¡œ ë³€í™˜
val customPool = Executors.newFixedThreadPool(4).asCoroutineDispatcher()

lifecycleScope.launch {
    withContext(customPool) {
        // 4ê°œ ìŠ¤ë ˆë“œ í’€ì—ì„œ ì‹¤í–‰
        heavyWork()
    }
}

// ë°˜ë“œì‹œ ì‚¬ìš© í›„ ì •ë¦¬!
// customPool.close() // ë˜ëŠ”
// (customPool as ExecutorCoroutineDispatcher).close()
```

### ìŠ¤ë ˆë“œ í’€ í¬ê¸° ê²°ì • ê°€ì´ë“œ

```
CPU ë°”ìš´ë“œ ì‘ì—…:
  ìŠ¤ë ˆë“œ ìˆ˜ = CPU ì½”ì–´ ìˆ˜
  (Dispatchers.Defaultê°€ ìë™ ì„¤ì •)

I/O ë°”ìš´ë“œ ì‘ì—…:
  ìŠ¤ë ˆë“œ ìˆ˜ = CPU ì½”ì–´ ìˆ˜ * (1 + ëŒ€ê¸°ì‹œê°„/ì²˜ë¦¬ì‹œê°„)
  (Dispatchers.IOê°€ ìµœëŒ€ 64ê°œë¡œ ìë™ ì„¤ì •)

í˜¼í•© ì‘ì—…:
  CPU ë¶€ë¶„ -> Dispatchers.Default
  I/O ë¶€ë¶„ -> Dispatchers.IO
  (ì½”ë£¨í‹´ì˜ withContextë¡œ ì‰½ê²Œ ì „í™˜)
```

### ì‹¤ì „ ì˜ˆì‹œ: ì´ë¯¸ì§€ ë¡œë”© íŒŒì´í”„ë¼ì¸

```kotlin
class ImagePipeline {
    // ë„¤íŠ¸ì›Œí¬ ë‹¤ìš´ë¡œë“œ: IO (ìµœëŒ€ 10ê°œ ë™ì‹œ)
    private val downloadDispatcher = Dispatchers.IO.limitedParallelism(10)
    // ë””ì½”ë”©/ë¦¬ì‚¬ì´ì¦ˆ: CPU (ì½”ì–´ ìˆ˜ - 1ê°œ)
    private val decodeDispatcher = Dispatchers.Default.limitedParallelism(
        maxOf(1, Runtime.getRuntime().availableProcessors() - 1)
    )
    // ë””ìŠ¤í¬ ìºì‹œ: IO (ìµœëŒ€ 4ê°œ ë™ì‹œ)
    private val cacheDispatcher = Dispatchers.IO.limitedParallelism(4)

    suspend fun loadImage(url: String): Bitmap {
        // 1ë‹¨ê³„: ìºì‹œ í™•ì¸
        val cached = withContext(cacheDispatcher) { diskCache.get(url) }
        if (cached != null) return cached

        // 2ë‹¨ê³„: ë‹¤ìš´ë¡œë“œ
        val bytes = withContext(downloadDispatcher) { download(url) }

        // 3ë‹¨ê³„: ë””ì½”ë”©
        val bitmap = withContext(decodeDispatcher) { decode(bytes) }

        // 4ë‹¨ê³„: ìºì‹œ ì €ì¥
        withContext(cacheDispatcher) { diskCache.put(url, bitmap) }

        return bitmap
    }
}
```

## ğŸ”— ê´€ë ¨ ê°œë…

- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/í”„ë¡œì„¸ìŠ¤-vs-ìŠ¤ë ˆë“œ|í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œ]]
- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/ë™ì‹œì„±-vs-ë³‘ë ¬ì„±|ë™ì‹œì„± vs ë³‘ë ¬ì„±]]
- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/ë¸”ë¡œí‚¹-vs-ë…¼ë¸”ë¡œí‚¹|ë¸”ë¡œí‚¹ vs ë…¼ë¸”ë¡œí‚¹]]
- [[00-CS-ê¸°ì´ˆ/ë™ì‹œì„±/ë™ê¸°-vs-ë¹„ë™ê¸°|ë™ê¸° vs ë¹„ë™ê¸°]]

## ğŸ“š ë” ë³´ê¸°

- [Coroutine Context and Dispatchers](https://kotlinlang.org/docs/coroutine-context-and-dispatchers.html)
- [Dispatchers.IO ë‚´ë¶€ êµ¬í˜„](https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-dispatchers/-i-o.html)
- [Android Threading Best Practices](https://developer.android.com/topic/performance/threads)

---

**í•µì‹¬ ìš”ì•½:** ìŠ¤ë ˆë“œ í’€ì€ ìŠ¤ë ˆë“œë¥¼ ë¯¸ë¦¬ ìƒì„±í•˜ì—¬ ì¬ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ìœ¼ë¡œ, Android ì½”ë£¨í‹´ì—ì„œëŠ” Dispatchers.Default(CPU ì‘ì—…, ì½”ì–´ ìˆ˜ ìŠ¤ë ˆë“œ)ì™€ Dispatchers.IO(I/O ì‘ì—…, ìµœëŒ€ 64 ìŠ¤ë ˆë“œ)ê°€ ì´ë¥¼ ìë™ ê´€ë¦¬í•˜ë©°, limitedParallelismìœ¼ë¡œ ì„¸ë°€í•œ ë™ì‹œì„± ì œì–´ê°€ ê°€ëŠ¥í•˜ë‹¤.