---
tags: [CS, λ³΄μ•, μ•”νΈν™”, Android, Keystore]
---

# μ•”νΈν™” κΈ°μ΄

## π’΅ ν•µμ‹¬ κ°λ…

μ•”νΈν™”(Encryption)λ€ ν‰λ¬Έ(Plaintext)μ„ νΉμ • μ•κ³ λ¦¬μ¦κ³Ό ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ μ½μ„ μ μ—†λ” μ•”νΈλ¬Έ(Ciphertext)μΌλ΅ λ³€ν™ν•λ” κ³Όμ •μ΄λ‹¤. λ³µνΈν™”(Decryption)λ” κ·Έ λ°λ€ κ³Όμ •μΌλ΅, μ•”νΈλ¬Έμ„ λ‹¤μ‹ ν‰λ¬ΈμΌλ΅ λλλ¦°λ‹¤. μ•λ“λ΅μ΄λ“μ—μ„λ” μ‚¬μ©μ λ°μ΄ν„°, ν† ν°, λ―Όκ° μ •λ³΄ λ“±μ„ λ³΄νΈν•κΈ° μ„ν•΄ μ•”νΈν™”κ°€ ν•„μμ μ΄λ‹¤.

## π“ μ™ ν•„μ”ν•κ°€?

μ•λ“λ΅μ΄λ“ μ•±μ€ λ΅μ»¬ μ €μ¥μ†(SharedPreferences, Room DB)μ— λ―Όκ° λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ±°λ‚, λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ μ „μ†΅ν•λ” κ²½μ°κ°€ λ§λ‹¤. μ•”νΈν™” μ—†μ΄λ” λ£¨ν…λ κΈ°κΈ°λ‚ μ¤‘κ°„μ κ³µκ²©(MITM)μΌλ΅ λ°μ΄ν„°κ°€ μ‰½κ² λ…Έμ¶λ  μ μλ‹¤.

## π” μμ„Έν

### μ•”νΈν™”μ κΈ°λ³Έ κµ¬μ„± μ”μ†

| κµ¬μ„± μ”μ† | μ„¤λ… |
|-----------|------|
| ν‰λ¬Έ(Plaintext) | μ•”νΈν™” μ „μ μ›λ³Έ λ°μ΄ν„° |
| μ•”νΈλ¬Έ(Ciphertext) | μ•”νΈν™” ν›„μ λ³€ν™λ λ°μ΄ν„° |
| ν‚¤(Key) | μ•”νΈν™”/λ³µνΈν™”μ— μ‚¬μ©λλ” λΉ„λ°€ κ°’ |
| μ•κ³ λ¦¬μ¦(Algorithm) | μ•”νΈν™” λ°©μ‹ (AES, RSA λ“±) |

### μ•”νΈν™”μ μΆ…λ¥

1. **λ€μΉ­ν‚¤ μ•”νΈν™”**: μ•”νΈν™”μ™€ λ³µνΈν™”μ— κ°™μ€ ν‚¤ μ‚¬μ© (AES)
2. **λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”**: κ³µκ°ν‚¤λ΅ μ•”νΈν™”, κ°μΈν‚¤λ΅ λ³µνΈν™” (RSA)
3. **ν•΄μ‹±**: λ‹¨λ°©ν–¥ λ³€ν™, λ³µνΈν™” λ¶κ°€ (SHA-256)

### Android Keystore μ‹μ¤ν…

Android Keystoreλ” μ•”νΈν™” ν‚¤λ¥Ό μ•μ „ν•κ² μ €μ¥ν•λ” μ‹μ¤ν…μ΄λ‹¤. ν‚¤κ°€ μ•± ν”„λ΅μ„Έμ¤ μ™Έλ¶€(TEE λλ” StrongBox)μ— μ €μ¥λλ―€λ΅ μ¶”μ¶μ΄ λ¶κ°€λ¥ν•λ‹¤.

```kotlin
// Android Keystoreμ—μ„ AES ν‚¤ μƒμ„±
val keyGenerator = KeyGenerator.getInstance(
    KeyProperties.KEY_ALGORITHM_AES,
    "AndroidKeyStore"
)

val keyGenParameterSpec = KeyGenParameterSpec.Builder(
    "my_secret_key",
    KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT
).apply {
    setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    setKeySize(256)
    // μƒμ²΄ μΈμ¦ ν•„μ” μ‹
    setUserAuthenticationRequired(true)
    setUserAuthenticationParameters(30, KeyProperties.AUTH_BIOMETRIC_STRONG)
}.build()

keyGenerator.init(keyGenParameterSpec)
val secretKey = keyGenerator.generateKey()
```

### EncryptedSharedPreferences ν™μ©

```kotlin
// Jetpack Security λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©
val masterKey = MasterKey.Builder(context)
    .setKeyScheme(MasterKey.KeyScheme.AES256_GCM)
    .build()

val encryptedPrefs = EncryptedSharedPreferences.create(
    context,
    "secret_prefs",
    masterKey,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
)

// μΌλ° SharedPreferencesμ™€ λ™μΌν•κ² μ‚¬μ©
encryptedPrefs.edit()
    .putString("auth_token", "eyJhbGciOiJI...")
    .apply()
```

### AES-GCM μ•”νΈν™”/λ³µνΈν™” μμ‹

```kotlin
fun encrypt(data: ByteArray, secretKey: SecretKey): Pair<ByteArray, ByteArray> {
    val cipher = Cipher.getInstance("AES/GCM/NoPadding")
    cipher.init(Cipher.ENCRYPT_MODE, secretKey)
    val iv = cipher.iv // μλ™ μƒμ„±λ IV
    val ciphertext = cipher.doFinal(data)
    return Pair(iv, ciphertext)
}

fun decrypt(iv: ByteArray, ciphertext: ByteArray, secretKey: SecretKey): ByteArray {
    val cipher = Cipher.getInstance("AES/GCM/NoPadding")
    val spec = GCMParameterSpec(128, iv)
    cipher.init(Cipher.DECRYPT_MODE, secretKey, spec)
    return cipher.doFinal(ciphertext)
}
```

### Network Security Config

```xml
<!-- res/xml/network_security_config.xml -->
<network-security-config>
    <!-- ν”„λ΅λ•μ…: HTTPSλ§ ν—μ© -->
    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">api.myapp.com</domain>
        <!-- Certificate Pinning -->
        <pin-set expiration="2025-12-31">
            <pin digest="SHA-256">base64_encoded_pin=</pin>
        </pin-set>
    </domain-config>
</network-security-config>
```

## π”— κ΄€λ ¨ κ°λ…

- [[00-CS-κΈ°μ΄/λ³΄μ•-κΈ°μ΄/λ€μΉ­ν‚¤-vs-λΉ„λ€μΉ­ν‚¤|λ€μΉ­ν‚¤ vs λΉ„λ€μΉ­ν‚¤]]
- [[00-CS-κΈ°μ΄/λ³΄μ•-κΈ°μ΄/ν•΄μ‹±|ν•΄μ‹±]]
- [[00-CS-κΈ°μ΄/λ³΄μ•-κΈ°μ΄/OAuth-JWT|OAuthμ™€ JWT]]

## π“ λ” λ³΄κΈ°

- [Android Keystore κ³µμ‹ λ¬Έμ„](https://developer.android.com/training/articles/keystore)
- [Jetpack Security](https://developer.android.com/topic/security/data)

---

**ν•µμ‹¬ μ”μ•½:** μ•”νΈν™”λ” λ°μ΄ν„°λ¥Ό μ½μ„ μ μ—†λ” ν•νƒλ΅ λ³€ν™ν•λ” κ²ƒμ΄λ©°, μ•λ“λ΅μ΄λ“μ—μ„λ” Keystoreμ™€ EncryptedSharedPreferencesλ¥Ό ν™μ©ν•μ—¬ λ―Όκ° λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² λ³΄νΈν•λ‹¤.
