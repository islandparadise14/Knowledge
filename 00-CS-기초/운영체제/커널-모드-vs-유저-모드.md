---
tags: [os, kernel, user-mode, system-call, android, linux]
---

# ì»¤ë„ ëª¨ë“œ vs ìœ ì € ëª¨ë“œ

## ğŸ’¡ í•µì‹¬ ê°œë…

CPUëŠ” **ì»¤ë„ ëª¨ë“œ(Kernel Mode)**ì™€ **ìœ ì € ëª¨ë“œ(User Mode)** ë‘ ê°€ì§€ ì‹¤í–‰ ëª¨ë“œë¥¼ ì œê³µí•œë‹¤. ì»¤ë„ ëª¨ë“œì—ì„œëŠ” í•˜ë“œì›¨ì–´ì™€ ë©”ëª¨ë¦¬ì— ë¬´ì œí•œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê³ , ìœ ì € ëª¨ë“œì—ì„œëŠ” ì œí•œëœ ì˜ì—­ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. ì´ ë¶„ë¦¬ë¥¼ í†µí•´ ì•±ì˜ ì˜¤ë¥˜ê°€ ì „ì²´ ì‹œìŠ¤í…œì„ ë§ê°€ëœ¨ë¦¬ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

Android ì•±ì€ ìœ ì € ëª¨ë“œì—ì„œ ì‹¤í–‰ë˜ê³ , íŒŒì¼ ì½ê¸°/ì“°ê¸°, ë„¤íŠ¸ì›Œí¬ í†µì‹ , ì¹´ë©”ë¼ ì ‘ê·¼ ë“±ì€ ëª¨ë‘ ì»¤ë„ ëª¨ë“œ ì „í™˜(ì‹œìŠ¤í…œ ì½œ)ì„ ê±°ì¹œë‹¤. ì´ êµ¬ì¡°ë¥¼ ì´í•´í•˜ë©´ ì„±ëŠ¥ ë³‘ëª©ê³¼ ë³´ì•ˆ ëª¨ë¸ì„ ë” ê¹Šì´ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

## ğŸ” ìì„¸íˆ

### ì‹¤í–‰ ëª¨ë“œì˜ ì°¨ì´

| êµ¬ë¶„ | ì»¤ë„ ëª¨ë“œ | ìœ ì € ëª¨ë“œ |
|------|-----------|-----------|
| ê¶Œí•œ | ëª¨ë“  CPU ëª…ë ¹ì–´ ì‹¤í–‰ ê°€ëŠ¥ | ì œí•œëœ ëª…ë ¹ì–´ë§Œ ì‹¤í–‰ |
| ë©”ëª¨ë¦¬ | ì „ì²´ ë©”ëª¨ë¦¬ ì ‘ê·¼ | í• ë‹¹ëœ ì˜ì—­ë§Œ ì ‘ê·¼ |
| í•˜ë“œì›¨ì–´ | ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥ | ì‹œìŠ¤í…œ ì½œì„ í†µí•´ì„œë§Œ |
| ì˜¤ë¥˜ ì˜í–¥ | ì‹œìŠ¤í…œ ì „ì²´ í¬ë˜ì‹œ (ì»¤ë„ íŒ¨ë‹‰) | í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ë§Œ ì¢…ë£Œ |
| ì‹¤í–‰ ì£¼ì²´ | OS ì»¤ë„, ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ | ì¼ë°˜ ì•±, ì‚¬ìš©ì í”„ë¡œê·¸ë¨ |

### ëª¨ë“œ ì „í™˜ ê³¼ì •

```
ìœ ì € ëª¨ë“œ (ì•± ì½”ë“œ ì‹¤í–‰)
    â”‚
    â”‚  ì‹œìŠ¤í…œ ì½œ (ì˜ˆ: read(), write())
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  íŠ¸ë©(Trap) / ì†Œí”„íŠ¸ì›¨ì–´  â”‚
â”‚  ì¸í„°ëŸ½íŠ¸ ë°œìƒ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
ì»¤ë„ ëª¨ë“œ (OSê°€ ìš”ì²­ ì²˜ë¦¬)
    â”‚
    â”‚  ì²˜ë¦¬ ì™„ë£Œ
    â”‚
    â–¼
ìœ ì € ëª¨ë“œ (ì•±ìœ¼ë¡œ ë³µê·€)
```

**ëª¨ë“œ ì „í™˜ ë¹„ìš©:**
- CPU ë ˆì§€ìŠ¤í„° ì €ì¥/ë³µì›
- ë©”ëª¨ë¦¬ ë§¤í•‘ ì „í™˜
- ìºì‹œ ì¼ë¶€ ë¬´íš¨í™”
- ìˆ˜ë°±~ìˆ˜ì²œ CPU ì‚¬ì´í´ ì†Œìš”

### ì‹œìŠ¤í…œ ì½œ (System Call)

ìœ ì € ëª¨ë“œì—ì„œ ì»¤ë„ ëª¨ë“œì˜ ê¸°ëŠ¥ì„ ìš”ì²­í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤:

| ì¹´í…Œê³ ë¦¬ | ì‹œìŠ¤í…œ ì½œ ì˜ˆì‹œ | Android ëŒ€ì‘ |
|----------|---------------|-------------|
| íŒŒì¼ I/O | open, read, write, close | FileInputStream, ContentResolver |
| í”„ë¡œì„¸ìŠ¤ | fork, exec, wait, exit | Zygote fork, Process.killProcess |
| ë©”ëª¨ë¦¬ | mmap, brk, munmap | Android mmap (Binder ë‚´ë¶€) |
| ë„¤íŠ¸ì›Œí¬ | socket, bind, connect, send | OkHttp, Retrofit (ë‚´ë¶€ì ìœ¼ë¡œ) |
| ë””ë°”ì´ìŠ¤ | ioctl | Camera, Sensor HAL |

### Androidì—ì„œì˜ ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ì•± (Kotlin/Java)     â”‚  ìœ ì € ëª¨ë“œ
â”‚    Activity, ViewModel, ...   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Android Framework        â”‚  ìœ ì € ëª¨ë“œ
â”‚  ActivityManager, WindowManagerâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Native Libraries          â”‚  ìœ ì € ëª¨ë“œ
â”‚   libc (Bionic), OpenGL, ...  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          HAL (Hardware         â”‚  ìœ ì € ëª¨ë“œ
â”‚      Abstraction Layer)        â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡  â† ì»¤ë„/ìœ ì € ê²½ê³„
â”‚       Linux Kernel            â”‚  ì»¤ë„ ëª¨ë“œ
â”‚  Binder Driver, ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„â”‚
â”‚  ë©”ëª¨ë¦¬ ê´€ë¦¬, íŒŒì¼ ì‹œìŠ¤í…œ, ë„¤íŠ¸ì›Œí¬â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Android ì•±ì˜ ì‹œìŠ¤í…œ ì½œ ì˜ˆì‹œ

```kotlin
// íŒŒì¼ ì“°ê¸° - ë‚´ë¶€ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ì½œ ë°œìƒ
fun writeFile(context: Context) {
    // openFileOutput â†’ open() ì‹œìŠ¤í…œ ì½œ
    // write() â†’ write() ì‹œìŠ¤í…œ ì½œ
    // close() â†’ close() ì‹œìŠ¤í…œ ì½œ
    context.openFileOutput("data.txt", Context.MODE_PRIVATE).use { fos ->
        fos.write("Hello".toByteArray())
    }
}

// ë„¤íŠ¸ì›Œí¬ ìš”ì²­ - ì†Œì¼“ ì‹œìŠ¤í…œ ì½œ ë°œìƒ
suspend fun fetchData(): String {
    // ë‚´ë¶€ì ìœ¼ë¡œ socket(), connect(), send(), recv() ì‹œìŠ¤í…œ ì½œ
    return withContext(Dispatchers.IO) {
        URL("https://api.example.com/data").readText()
    }
}
```

ADBë¡œ ì•±ì˜ ì‹œìŠ¤í…œ ì½œì„ ì¶”ì í•  ìˆ˜ ìˆë‹¤:

```bash
# straceë¡œ í”„ë¡œì„¸ìŠ¤ì˜ ì‹œìŠ¤í…œ ì½œ ì¶”ì 
adb shell strace -p <PID> -f -e trace=file

# ì¶œë ¥ ì˜ˆì‹œ:
# openat(AT_FDCWD, "/data/data/com.example/files/data.txt", O_WRONLY|O_CREAT, 0600) = 12
# write(12, "Hello", 5) = 5
# close(12) = 0
```

### ì¸í„°ëŸ½íŠ¸ì™€ ëª¨ë“œ ì „í™˜

ì»¤ë„ ëª¨ë“œë¡œì˜ ì „í™˜ì€ ì‹œìŠ¤í…œ ì½œ ì™¸ì— **ì¸í„°ëŸ½íŠ¸**ë¡œë„ ë°œìƒí•œë‹¤:

| ì „í™˜ ì›ì¸ | ì„¤ëª… | ì˜ˆì‹œ |
|-----------|------|------|
| ì‹œìŠ¤í…œ ì½œ | ì•±ì´ OS ê¸°ëŠ¥ ìš”ì²­ | íŒŒì¼ ì½ê¸°, ë„¤íŠ¸ì›Œí¬ |
| í•˜ë“œì›¨ì–´ ì¸í„°ëŸ½íŠ¸ | í•˜ë“œì›¨ì–´ ì´ë²¤íŠ¸ | í„°ì¹˜ ì…ë ¥, ì„¼ì„œ ë°ì´í„° |
| ì˜ˆì™¸ (Exception) | CPU ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ | Segmentation Fault, 0 ë‚˜ëˆ„ê¸° |
| íƒ€ì´ë¨¸ ì¸í„°ëŸ½íŠ¸ | ìŠ¤ì¼€ì¤„ë§ íƒ€ì´ë¨¸ | í”„ë¡œì„¸ìŠ¤ ì„ ì  |

### SELinuxì™€ Android ë³´ì•ˆ

AndroidëŠ” Linuxì˜ DAC(Discretionary Access Control) ìœ„ì— **SELinux**(Security-Enhanced Linux)ë¥¼ ì ìš©í•œë‹¤:

```
DAC: íŒŒì¼ ì†Œìœ ìê°€ ê¶Œí•œ ì„¤ì • (rwx)
SELinux (MAC): ì»¤ë„ì´ ì •ì±… ê¸°ë°˜ìœ¼ë¡œ ê°•ì œ ì ‘ê·¼ ì œì–´

Androidì—ì„œì˜ SELinux:
- ì•±ì€ ê³ ìœ  ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì§
- ì •ì±…ì— ëª…ì‹œë˜ì§€ ì•Šì€ ì ‘ê·¼ì€ ëª¨ë‘ ê±°ë¶€
- ë£¨íŒ…í•´ë„ SELinuxê°€ ì•…ì˜ì  ì ‘ê·¼ì„ ì°¨ë‹¨
```

```bash
# SELinux ìƒíƒœ í™•ì¸
adb shell getenforce
# ì¶œë ¥: Enforcing

# ì•±ì˜ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ í™•ì¸
adb shell ps -Z | grep com.example
# u:r:untrusted_app:s0:c123,c456 ... com.example.app
```

### ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

```kotlin
// BAD: ë¶ˆí•„ìš”í•œ ì‹œìŠ¤í…œ ì½œ ë°˜ë³µ
fun readLineByLine(context: Context): List<String> {
    val lines = mutableListOf<String>()
    val file = File(context.filesDir, "large_file.txt")
    // ê° readLine()ë§ˆë‹¤ read() ì‹œìŠ¤í…œ ì½œ â†’ ëª¨ë“œ ì „í™˜ ë°˜ë³µ
    file.forEachLine { lines.add(it) }
    return lines
}

// GOOD: ë²„í¼ë§ìœ¼ë¡œ ì‹œìŠ¤í…œ ì½œ ìµœì†Œí™”
fun readBuffered(context: Context): String {
    val file = File(context.filesDir, "large_file.txt")
    // BufferedReaderê°€ ë‚´ë¶€ì ìœ¼ë¡œ í° ë²„í¼(8KB)ë¡œ read() íšŸìˆ˜ ì¤„ì„
    return file.bufferedReader().use { it.readText() }
}

// GOOD: mmapìœ¼ë¡œ íŒŒì¼ ë§¤í•‘ (ëŒ€ìš©ëŸ‰ íŒŒì¼)
fun readWithMmap(file: File): ByteBuffer {
    val channel = FileInputStream(file).channel
    // mmap() ì‹œìŠ¤í…œ ì½œ 1íšŒ â†’ ì´í›„ ë©”ëª¨ë¦¬ ì ‘ê·¼ìœ¼ë¡œ ì½ê¸°
    return channel.map(FileChannel.MapMode.READ_ONLY, 0, channel.size())
}
```

### Bionic vs glibc

AndroidëŠ” í‘œì¤€ glibc ëŒ€ì‹  ê²½ëŸ‰í™”ëœ **Bionic** C ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤:

| êµ¬ë¶„ | glibc (í‘œì¤€ Linux) | Bionic (Android) |
|------|-------------------|-----------------|
| í¬ê¸° | ëŒ€í˜• | ê²½ëŸ‰ |
| ë¼ì´ì„ ìŠ¤ | LGPL | BSD |
| ìŠ¤ë ˆë“œ | NPTL | ìì²´ êµ¬í˜„ (pthread ê¸°ë°˜) |
| DNS | nsswitch | ìì²´ resolver |
| í˜¸í™˜ì„± | POSIX ì™„ì „ ì¤€ìˆ˜ | ë¶€ë¶„ ì¤€ìˆ˜ |

ì‹œìŠ¤í…œ ì½œì„ ê°ì‹¸ëŠ” ë˜í¼ ì—­í• ì„ í•˜ë©°, NDKë¡œ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ Bionicì´ ì‚¬ìš©ëœë‹¤.

## ğŸ”— ê´€ë ¨ ê°œë…

- [[00-CS-ê¸°ì´ˆ/ìš´ì˜ì²´ì œ/Linux-ê¸°ì´ˆ|Linux ê¸°ì´ˆ]]
- [[00-CS-ê¸°ì´ˆ/ìš´ì˜ì²´ì œ/í”„ë¡œì„¸ìŠ¤-ê´€ë¦¬|í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬]]
- [[00-CS-ê¸°ì´ˆ/ìš´ì˜ì²´ì œ/íŒŒì¼-ì‹œìŠ¤í…œ|íŒŒì¼ ì‹œìŠ¤í…œ]]
- [[00-CS-ê¸°ì´ˆ/ë©”ëª¨ë¦¬/ê°€ìƒ-ë©”ëª¨ë¦¬|ê°€ìƒ ë©”ëª¨ë¦¬]]
- [[00-CS-ê¸°ì´ˆ/ë³´ì•ˆ-ê¸°ì´ˆ/ì¸ì¦-vs-ì¸ê°€|ì¸ì¦ vs ì¸ê°€]]

## ğŸ“š ë” ë³´ê¸°

- [Android Architecture Overview](https://source.android.com/docs/core/architecture)
- [Linux System Call Table](https://filippo.io/linux-syscall-table/)

---

**í•µì‹¬ ìš”ì•½:** ì•±ì€ ìœ ì € ëª¨ë“œì—ì„œ ì‹¤í–‰ë˜ê³ , í•˜ë“œì›¨ì–´/íŒŒì¼/ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì‹œ ì‹œìŠ¤í…œ ì½œë¡œ ì»¤ë„ ëª¨ë“œ ì „í™˜. ëª¨ë“œ ì „í™˜ì—ëŠ” ë¹„ìš©ì´ ìˆìœ¼ë¯€ë¡œ ë²„í¼ë§ê³¼ ë°°ì¹˜ ì²˜ë¦¬ë¡œ ìµœì†Œí™”.
