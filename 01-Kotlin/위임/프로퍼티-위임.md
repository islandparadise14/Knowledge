---
tags: [kotlin, delegation, property]
---

# í”„ë¡œí¼í‹° ìœ„ì„ (Property Delegation)

## ğŸ’¡ í•µì‹¬ ê°œë…

**í”„ë¡œí¼í‹° ìœ„ì„**ì€ í”„ë¡œí¼í‹°ì˜ getter/setter ë¡œì§ì„ ë³„ë„ ê°ì²´ì— ìœ„ì„í•˜ëŠ” íŒ¨í„´ì´ë‹¤. `by` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ë©°, ë°˜ë³µë˜ëŠ” í”„ë¡œí¼í‹° ë¡œì§ì„ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë§Œë“ ë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

í”„ë¡œí¼í‹°ë§ˆë‹¤ ë¹„ìŠ·í•œ ì´ˆê¸°í™”, ê²€ì¦, ë³€í™˜ ë¡œì§ì„ ë°˜ë³µ ì‘ì„±í•˜ë©´ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ê°€ ëŠ˜ì–´ë‚œë‹¤. ìœ„ì„ì„ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ê³µí†µ íŒ¨í„´ì„ í•œ ë²ˆë§Œ ì •ì˜í•˜ê³  ì—¬ëŸ¬ í”„ë¡œí¼í‹°ì— ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. Androidì—ì„œëŠ” `by lazy`, `by viewModels()`, `by remember` ë“± ê±°ì˜ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.

## ğŸ” ìì„¸íˆ

### ê¸°ë³¸ ì‚¬ìš©ë²•

```kotlin
// by í‚¤ì›Œë“œë¡œ í”„ë¡œí¼í‹° ìœ„ì„
class Example {
    // lazy - ì²˜ìŒ ì ‘ê·¼ ì‹œ ì´ˆê¸°í™”
    val heavyObject: HeavyObject by lazy {
        HeavyObject()
    }

    // observable - ê°’ ë³€ê²½ ê°ì§€
    var name: String by Delegates.observable("ì´ˆê¸°ê°’") { property, old, new ->
        println("$old -> $new")
    }

    // vetoable - ê°’ ë³€ê²½ ê±°ë¶€ ê°€ëŠ¥
    var age: Int by Delegates.vetoable(0) { _, _, new ->
        new >= 0  // false ë°˜í™˜ ì‹œ ë³€ê²½ ê±°ë¶€
    }
}
```

### ë™ì‘ ì›ë¦¬

**ìœ„ì„ í”„ë¡œí¼í‹°ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `getValue`/`setValue` í˜¸ì¶œë¡œ ë³€í™˜ëœë‹¤:**

```kotlin
// ì´ ì½”ë“œëŠ”:
class MyClass {
    var prop: String by MyDelegate()
}

// ì»´íŒŒì¼ëŸ¬ê°€ ì´ë ‡ê²Œ ë³€í™˜:
class MyClass {
    private val prop$delegate = MyDelegate()

    var prop: String
        get() = prop$delegate.getValue(this, this::prop)
        set(value) = prop$delegate.setValue(this, this::prop, value)
}
```

**ì»¤ìŠ¤í…€ ìœ„ì„ ë§Œë“¤ê¸°:**

```kotlin
import kotlin.reflect.KProperty

// ReadWriteProperty ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
class TrimDelegate : ReadWriteProperty<Any?, String> {
    private var trimmedValue: String = ""

    override fun getValue(thisRef: Any?, property: KProperty<*>): String {
        return trimmedValue
    }

    override fun setValue(thisRef: Any?, property: KProperty<*>, value: String) {
        trimmedValue = value.trim()
    }
}

// ì‚¬ìš©
class UserForm {
    var name: String by TrimDelegate()
    var email: String by TrimDelegate()
}

val form = UserForm()
form.name = "  ë¯¼íŠ¸  "
println(form.name)  // "ë¯¼íŠ¸"
```

### í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìœ„ì„

**1. lazy**

```kotlin
// ê¸°ë³¸ - thread-safe (SYNCHRONIZED)
val config: Config by lazy {
    loadConfig()
}

// ë‹¨ì¼ ìŠ¤ë ˆë“œ í™˜ê²½ì´ë©´ NONEìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ
val adapter: Adapter by lazy(LazyThreadSafetyMode.NONE) {
    Adapter()
}

// PUBLICATION - ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì´ˆê¸°í™” ê°€ëŠ¥í•˜ì§€ë§Œ ì²« ë²ˆì§¸ ê²°ê³¼ë§Œ ì‚¬ìš©
val cache: Cache by lazy(LazyThreadSafetyMode.PUBLICATION) {
    buildCache()
}
```

**2. observable**

```kotlin
var count: Int by Delegates.observable(0) { prop, old, new ->
    println("${prop.name}: $old -> $new")
    onCountChanged(new)
}

count = 5   // "count: 0 -> 5"
count = 10  // "count: 5 -> 10"
```

**3. vetoable**

```kotlin
var percentage: Int by Delegates.vetoable(0) { _, _, new ->
    new in 0..100  // 0~100 ë²”ìœ„ë§Œ í—ˆìš©
}

percentage = 50   // OK
percentage = 150  // ê±°ë¶€ë¨, ì—¬ì „íˆ 50
```

**4. notNull**

```kotlin
// lateinitê³¼ ìœ ì‚¬í•˜ì§€ë§Œ primitive íƒ€ì…ì— ì‚¬ìš© ê°€ëŠ¥
var count: Int by Delegates.notNull<Int>()

// ì´ˆê¸°í™” ì „ ì ‘ê·¼í•˜ë©´ IllegalStateException
```

### Mapì„ í†µí•œ ìœ„ì„

```kotlin
// Mapì—ì„œ í”„ë¡œí¼í‹° ê°’ì„ ê°€ì ¸ì˜¤ê¸°
class User(map: Map<String, Any?>) {
    val name: String by map
    val age: Int by map
}

val user = User(mapOf("name" to "ë¯¼íŠ¸", "age" to 27))
println(user.name)  // "ë¯¼íŠ¸"
println(user.age)   // 27

// MutableMapì´ë©´ varë„ ê°€ëŠ¥
class MutableUser(map: MutableMap<String, Any?>) {
    var name: String by map
    var age: Int by map
}
```

### provideDelegate

```kotlin
// ìœ„ì„ ê°ì²´ ìƒì„± ì‹œì ì— ê²€ì¦ ë¡œì§ ì¶”ê°€
class ResourceLoader(val prefix: String) {
    operator fun provideDelegate(
        thisRef: Any?,
        prop: KProperty<*>
    ): ReadOnlyProperty<Any?, String> {
        // í”„ë¡œí¼í‹° ì´ë¦„ ê¸°ë°˜ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ê²€ì¦
        val resourceKey = "$prefix.${prop.name}"
        require(resourceExists(resourceKey)) {
            "Resource $resourceKey not found"
        }
        return ResourceProperty(resourceKey)
    }
}

class App {
    val title by ResourceLoader("strings")   // strings.title ê²€ì¦
    val version by ResourceLoader("config")   // config.version ê²€ì¦
}
```

### ì£¼ì˜ì‚¬í•­

**1. lazyëŠ” valë§Œ ê°€ëŠ¥**

```kotlin
// lazyëŠ” val ì „ìš©
val value: String by lazy { "Hello" }  // OK
// var value: String by lazy { "Hello" }  // ERROR
```

**2. ìœ„ì„ í”„ë¡œí¼í‹°ì™€ backing field**

```kotlin
// ìœ„ì„ í”„ë¡œí¼í‹°ëŠ” backing fieldë¥¼ ê°€ì§€ì§€ ì•ŠìŒ
class MyClass {
    var prop: String by MyDelegate()
    // field í‚¤ì›Œë“œ ì‚¬ìš© ë¶ˆê°€
}
```

**3. ì¸í„°í˜ì´ìŠ¤ í”„ë¡œí¼í‹° ìœ„ì„**

```kotlin
interface HasName {
    val name: String
}

// ì¸í„°í˜ì´ìŠ¤ í”„ë¡œí¼í‹°ë„ ìœ„ì„ ê°€ëŠ¥
class NamedEntity(map: Map<String, Any?>) : HasName {
    override val name: String by map
}
```

## ğŸ’» ì‹¤ì „ ì˜ˆì œ

### SharedPreferences ìœ„ì„

```kotlin
class PreferenceDelegate<T>(
    private val prefs: SharedPreferences,
    private val key: String,
    private val defaultValue: T
) : ReadWriteProperty<Any?, T> {

    @Suppress("UNCHECKED_CAST")
    override fun getValue(thisRef: Any?, property: KProperty<*>): T {
        return when (defaultValue) {
            is String -> prefs.getString(key, defaultValue) as T
            is Int -> prefs.getInt(key, defaultValue) as T
            is Boolean -> prefs.getBoolean(key, defaultValue) as T
            is Long -> prefs.getLong(key, defaultValue) as T
            is Float -> prefs.getFloat(key, defaultValue) as T
            else -> throw IllegalArgumentException("Unsupported type")
        }
    }

    override fun setValue(thisRef: Any?, property: KProperty<*>, value: T) {
        prefs.edit {
            when (value) {
                is String -> putString(key, value)
                is Int -> putInt(key, value)
                is Boolean -> putBoolean(key, value)
                is Long -> putLong(key, value)
                is Float -> putFloat(key, value)
            }
        }
    }
}

// í™•ì¥ í•¨ìˆ˜ë¡œ í¸ë¦¬í•˜ê²Œ
fun <T> SharedPreferences.delegate(key: String, defaultValue: T) =
    PreferenceDelegate(this, key, defaultValue)

// ì‚¬ìš©
class SettingsManager(prefs: SharedPreferences) {
    var isDarkMode: Boolean by prefs.delegate("dark_mode", false)
    var userName: String by prefs.delegate("user_name", "")
    var fontSize: Int by prefs.delegate("font_size", 14)
}
```

### ViewModel ìœ„ì„ (Android KTX)

```kotlin
class MainActivity : AppCompatActivity() {
    // Activityì—ì„œ ViewModel ìœ„ì„
    private val viewModel: MainViewModel by viewModels()

    // Factory ì‚¬ìš©
    private val detailViewModel: DetailViewModel by viewModels {
        DetailViewModel.Factory(userId)
    }
}

class UserFragment : Fragment() {
    // Fragmentì—ì„œ ViewModel ìœ„ì„
    private val viewModel: UserViewModel by viewModels()

    // Activity ë²”ìœ„ ViewModel ê³µìœ 
    private val sharedViewModel: SharedViewModel by activityViewModels()
}
```

### Composeì—ì„œì˜ ìœ„ì„

```kotlin
@Composable
fun CounterScreen() {
    // remember + mutableStateOfë¥¼ byë¡œ ìœ„ì„
    var count by remember { mutableStateOf(0) }
    var text by remember { mutableStateOf("") }

    Column {
        Text("Count: $count")
        Button(onClick = { count++ }) {
            Text("Increment")
        }
        TextField(
            value = text,
            onValueChange = { text = it }
        )
    }
}
```

### Bundle Argument ìœ„ì„

```kotlin
// Fragment argumentë¥¼ ìœ„ì„ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ
fun <T> Fragment.argument(key: String): ReadOnlyProperty<Fragment, T> =
    ReadOnlyProperty { thisRef, _ ->
        @Suppress("UNCHECKED_CAST")
        thisRef.requireArguments().get(key) as T
    }

fun <T> Fragment.argumentOrNull(key: String): ReadOnlyProperty<Fragment, T?> =
    ReadOnlyProperty { thisRef, _ ->
        @Suppress("UNCHECKED_CAST")
        thisRef.arguments?.get(key) as? T
    }

// ì‚¬ìš©
class UserFragment : Fragment() {
    private val userId: String by argument("user_id")
    private val title: String? by argumentOrNull("title")

    companion object {
        fun newInstance(userId: String) = UserFragment().apply {
            arguments = bundleOf("user_id" to userId)
        }
    }
}
```

## ğŸ”— ê´€ë ¨ ê°œë…

- [[01-Kotlin/ê¸°ë³¸ë¬¸ë²•/ë³€ìˆ˜ì™€-íƒ€ì…|ë³€ìˆ˜ì™€ íƒ€ì… - lateinit vs lazy]]
- [[01-Kotlin/í´ë˜ìŠ¤-ì¢…ë¥˜/Objectì™€-Companion|Objectì™€ Companion]]
- [[03-Android-Core/ViewModel/ViewModel-ê¸°ì´ˆ|ViewModel]]
- [[04-Jetpack-Compose/ìƒíƒœ-ê´€ë¦¬/rememberì™€-State|rememberì™€ State]]

## ğŸ“š ë” ë³´ê¸°

- [Kotlin Docs - Delegated Properties](https://kotlinlang.org/docs/delegated-properties.html)
- [Kotlin Docs - Delegation](https://kotlinlang.org/docs/delegation.html)

---

**í•µì‹¬ ìš”ì•½:** `by` í‚¤ì›Œë“œë¡œ í”„ë¡œí¼í‹° ë¡œì§ì„ ìœ„ì„. lazy, observable, vetoableì€ í‘œì¤€ ì œê³µ. ì»¤ìŠ¤í…€ ìœ„ì„ìœ¼ë¡œ SharedPreferences, Bundle ë“± ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì œê±°. Androidì—ì„œëŠ” viewModels(), remember ë“± í•„ìˆ˜ íŒ¨í„´.
