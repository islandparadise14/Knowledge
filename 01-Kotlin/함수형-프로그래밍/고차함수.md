---
tags: [kotlin, functional-programming, higher-order-function]
---

# ê³ ì°¨í•¨ìˆ˜

## ğŸ’¡ í•µì‹¬ ê°œë…

**ê³ ì°¨í•¨ìˆ˜(Higher-Order Function)**ëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê±°ë‚˜ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë‹¤. Kotlinì—ì„œ í•¨ìˆ˜ëŠ” ì¼ê¸‰ ê°ì²´(first-class citizen)ì´ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•˜ë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?

ì½”ë“œ ì¬ì‚¬ìš©ì„±ê³¼ ìœ ì—°ì„±ì„ ë†’ì¸ë‹¤. ì½œë°±, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ, ì»¬ë ‰ì…˜ ì²˜ë¦¬ ë“± ëª¨ë“  ê³³ì—ì„œ ì‚¬ìš©ëœë‹¤. í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì˜ í•µì‹¬ì´ë‹¤.

### ì¼ê¸‰ ê°ì²´ì™€ì˜ ê´€ê³„

| ê°œë… | ì˜ë¯¸ |
|------|------|
| **ì¼ê¸‰ ê°ì²´** | í•¨ìˆ˜ë¥¼ ê°’ì²˜ëŸ¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤ (ì¡°ê±´) |
| **ê³ ì°¨ í•¨ìˆ˜** | í•¨ìˆ˜ë¥¼ ì¸ì/ë°˜í™˜ê°’ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ (í™œìš©) |

ì¼ê¸‰ ê°ì²´ëŠ” **ìê²©**ì´ê³ , ê³ ì°¨ í•¨ìˆ˜ëŠ” ê·¸ ìê²©ì„ **í™œìš©**í•˜ëŠ” ë°©ì‹ì´ë‹¤.

## ğŸ” ìì„¸íˆ

### ê¸°ë³¸ ì‚¬ìš©ë²•

```kotlin
// í•¨ìˆ˜ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” ê³ ì°¨í•¨ìˆ˜
fun calculate(a: Int, b: Int, operation: (Int, Int) -> Int): Int {
    return operation(a, b)
}

// ì‚¬ìš©
val sum = calculate(5, 3) { x, y -> x + y }  // 8
val product = calculate(5, 3) { x, y -> x * y }  // 15

// í•¨ìˆ˜ ì°¸ì¡° ì‚¬ìš©
fun add(a: Int, b: Int) = a + b
val result = calculate(5, 3, ::add)
```

### í•¨ìˆ˜ íƒ€ì…

```kotlin
// í•¨ìˆ˜ íƒ€ì… ì„ ì–¸
val sum: (Int, Int) -> Int = { a, b -> a + b }
val greet: (String) -> String = { name -> "Hello, $name" }
val print: (String) -> Unit = { println(it) }

// nullable ë°˜í™˜
val findUser: (String) -> User? = { id -> 
    // ... 
}

// nullable í•¨ìˆ˜ íƒ€ì…
val operation: ((Int, Int) -> Int)? = null
```

### í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜

```kotlin
fun operation(op: String): (Int, Int) -> Int {
    return when (op) {
        "+" -> { a, b -> a + b }
        "-" -> { a, b -> a - b }
        "*" -> { a, b -> a * b }
        else -> { a, b -> 0 }
    }
}

// ì‚¬ìš©
val add = operation("+")
val result = add(5, 3)  // 8
```

### ëŒë‹¤ í‘œí˜„ì‹

```kotlin
// ê¸°ë³¸ ëŒë‹¤
val sum = { a: Int, b: Int -> a + b }

// íƒ€ì… ì¶”ë¡ 
val sum: (Int, Int) -> Int = { a, b -> a + b }

// ë‹¨ì¼ íŒŒë¼ë¯¸í„°ëŠ” it
val double: (Int) -> Int = { it * 2 }

// ì—¬ëŸ¬ ì¤„ ëŒë‹¤ (ë§ˆì§€ë§‰ í‘œí˜„ì‹ì´ ë°˜í™˜ê°’)
val complex: (Int) -> Int = { num ->
    val squared = num * num
    val doubled = squared * 2
    doubled  // ë°˜í™˜
}

// íŒŒë¼ë¯¸í„° ì‚¬ìš© ì•ˆ í•˜ë©´ _
list.forEachIndexed { index, _ ->
    println(index)
}
```

### í›„í–‰ ëŒë‹¤ (Trailing Lambda)

```kotlin
// ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„°ê°€ í•¨ìˆ˜ë©´ ê´„í˜¸ ë°–ìœ¼ë¡œ
fun repeat(times: Int, action: () -> Unit) {
    for (i in 0 until times) {
        action()
    }
}

// ì¼ë°˜ í˜¸ì¶œ
repeat(3, { println("Hello") })

// í›„í–‰ ëŒë‹¤
repeat(3) {
    println("Hello")
}

// íŒŒë¼ë¯¸í„°ê°€ ëŒë‹¤ë§Œ ìˆìœ¼ë©´ ê´„í˜¸ ìƒëµ
list.filter { it > 5 }
```

### ë™ì‘ ì›ë¦¬

**í•¨ìˆ˜ íƒ€ì…ì˜ ë‚´ë¶€ êµ¬í˜„**

```kotlin
val sum: (Int, Int) -> Int = { a, b -> a + b }

// ì»´íŒŒì¼ í›„ (ëŒ€ëµ)
Function2<Int, Int, Int> sum = new Function2<Int, Int, Int>() {
    public Int invoke(Int a, Int b) {
        return a + b;
    }
};
```

**ì¸ë¼ì¸ í•¨ìˆ˜ë¡œ ì˜¤ë²„í—¤ë“œ ì œê±°**

```kotlin
// ì¸ë¼ì¸ ì•„ë‹˜ - Function ê°ì²´ ìƒì„±
fun doSomething(block: () -> Unit) {
    block()
}

// ì¸ë¼ì¸ - ëŒë‹¤ ì½”ë“œê°€ ì§ì ‘ ì‚½ì…ë¨
inline fun doSomething(block: () -> Unit) {
    block()
}
```

### ì£¼ì˜ì‚¬í•­

**1. ë¦¬ì‹œë²„ê°€ ìˆëŠ” í•¨ìˆ˜ íƒ€ì…**

```kotlin
// ì¼ë°˜ í•¨ìˆ˜ íƒ€ì…
val operation: (Int, Int) -> Int = { a, b -> a + b }

// ë¦¬ì‹œë²„ê°€ ìˆëŠ” í•¨ìˆ˜ íƒ€ì…
val stringOperation: String.() -> Int = { this.length }

// ì‚¬ìš©
"Hello".stringOperation()  // 5

// apply, with ë“±ì´ ì´ëŸ° ë°©ì‹
```

**2. í•¨ìˆ˜ íƒ€ì…ì˜ null safety**

```kotlin
var callback: (() -> Unit)? = null

// ì•ˆì „ í˜¸ì¶œ
callback?.invoke()

// ë˜ëŠ”
if (callback != null) {
    callback()
}
```

**3. í´ë¡œì € (Closure)**

```kotlin
fun makeCounter(): () -> Int {
    var count = 0
    return {
        count++  // ì™¸ë¶€ ë³€ìˆ˜ ìº¡ì²˜
        count
    }
}

val counter = makeCounter()
println(counter())  // 1
println(counter())  // 2
println(counter())  // 3
```

## ğŸ’» ì‹¤ì „ ì˜ˆì œ

### ì»¬ë ‰ì…˜ ì²˜ë¦¬

```kotlin
val numbers = listOf(1, 2, 3, 4, 5)

// filter
val evens = numbers.filter { it % 2 == 0 }  // [2, 4]

// map
val doubled = numbers.map { it * 2 }  // [2, 4, 6, 8, 10]

// flatMap
val nestedLists = listOf(listOf(1, 2), listOf(3, 4))
val flattened = nestedLists.flatMap { it }  // [1, 2, 3, 4]

// reduce
val sum = numbers.reduce { acc, num -> acc + num }  // 15

// fold (ì´ˆê¸°ê°’ ìˆìŒ)
val sum2 = numbers.fold(100) { acc, num -> acc + num }  // 115

// groupBy
data class User(val name: String, val age: Int)
val users = listOf(
    User("ë¯¼íŠ¸", 27),
    User("ë¯¼íŠ¸2", 27),
    User("ë¯¼íŠ¸3", 30)
)
val grouped = users.groupBy { it.age }
// {27=[User(ë¯¼íŠ¸, 27), User(ë¯¼íŠ¸2, 27)], 30=[User(ë¯¼íŠ¸3, 30)]}
```

### Android ì½œë°± ì²˜ë¦¬

```kotlin
// ì „í†µì ì¸ ë°©ì‹
button.setOnClickListener(object : View.OnClickListener {
    override fun onClick(v: View?) {
        // ...
    }
})

// ëŒë‹¤ ì‚¬ìš©
button.setOnClickListener { view ->
    // ...
}

// it ì‚¬ìš©
button.setOnClickListener {
    // it: View
}
```

### ViewModel ìƒíƒœ ì—…ë°ì´íŠ¸

```kotlin
class MyViewModel : ViewModel() {
    private val _uiState = MutableStateFlow(UiState())
    val uiState: StateFlow<UiState> = _uiState.asStateFlow()
    
    // ê³ ì°¨í•¨ìˆ˜ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸
    private fun updateState(block: (UiState) -> UiState) {
        _uiState.update(block)
    }
    
    fun loadData() {
        updateState { it.copy(isLoading = true) }
        viewModelScope.launch {
            val data = repository.getData()
            updateState { it.copy(data = data, isLoading = false) }
        }
    }
}
```

### DSL ìŠ¤íƒ€ì¼ API

```kotlin
fun html(init: HTML.() -> Unit): HTML {
    val html = HTML()
    html.init()
    return html
}

class HTML {
    private val children = mutableListOf<String>()
    
    fun head(init: Head.() -> Unit) {
        val head = Head()
        head.init()
        children.add(head.toString())
    }
    
    fun body(init: Body.() -> Unit) {
        val body = Body()
        body.init()
        children.add(body.toString())
    }
}

// ì‚¬ìš©
val page = html {
    head {
        title = "My Page"
    }
    body {
        h1 = "Hello"
        p = "World"
    }
}
```

### Retry ë¡œì§

```kotlin
suspend fun <T> retry(
    times: Int = 3,
    initialDelay: Long = 100,
    maxDelay: Long = 1000,
    factor: Double = 2.0,
    block: suspend () -> T
): T {
    var currentDelay = initialDelay
    repeat(times - 1) {
        try {
            return block()
        } catch (e: Exception) {
            delay(currentDelay)
            currentDelay = (currentDelay * factor).toLong().coerceAtMost(maxDelay)
        }
    }
    return block()  // ë§ˆì§€ë§‰ ì‹œë„
}

// ì‚¬ìš©
val user = retry {
    api.getUser(id)
}
```

### í•¨ìˆ˜ í•©ì„±

```kotlin
// í•¨ìˆ˜ í•©ì„±
fun <A, B, C> ((A) -> B).andThen(f: (B) -> C): (A) -> C {
    return { a -> f(this(a)) }
}

val addOne: (Int) -> Int = { it + 1 }
val double: (Int) -> Int = { it * 2 }

val addOneThenDouble = addOne.andThen(double)
addOneThenDouble(5)  // 12
```

### MutableStateFlow.update êµ¬í˜„

```kotlin
// Kotlin í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ update í•¨ìˆ˜ ìœ ì‚¬
inline fun <T> MutableStateFlow<T>.update(function: (T) -> T) {
    while (true) {
        val prevValue = value
        val nextValue = function(prevValue)
        if (compareAndSet(prevValue, nextValue)) {
            return
        }
    }
}
```

## ğŸ”— ê´€ë ¨ ê°œë…

- [[01-Kotlin/í•¨ìˆ˜í˜•-í”„ë¡œê·¸ë˜ë°/ëŒë‹¤-í‘œí˜„ì‹]]
- [[01-Kotlin/í•¨ìˆ˜í˜•-í”„ë¡œê·¸ë˜ë°/ì¸ë¼ì¸-í•¨ìˆ˜]]
- [[01-Kotlin/í•¨ìˆ˜í˜•-í”„ë¡œê·¸ë˜ë°/Scope-Functions]]

## ğŸ“š ë” ë³´ê¸°

- [Kotlin Docs - Higher-Order Functions](https://kotlinlang.org/docs/lambdas.html)

---

**í•µì‹¬ ìš”ì•½:** í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê±°ë‚˜ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜. ëŒë‹¤ì™€ í•¨ê»˜ ì‚¬ìš©. ì»¬ë ‰ì…˜ ì²˜ë¦¬ì™€ ì½œë°±ì— í•„ìˆ˜.
